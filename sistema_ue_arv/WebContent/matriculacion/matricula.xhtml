<ui:composition template="/layout/layout.xhtml"
xmlns="http://www.w3.org/1999/xhtml"
xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
xmlns:h="http://xmlns.jcp.org/jsf/html"
xmlns:p="http://primefaces.org/ui"
xmlns:f="http://xmlns.jcp.org/jsf/core"
xmlns:pe="http://primefaces.org/ui/extensions">
			
	<ui:define name="titulo"><i class="fa fa-address-card" /> Matriculación / Matrículas</ui:define>
	
	<ui:define name="content">
		<h:form id="form" style="width: 100%">
			<f:metadata>
			    <f:viewAction action="#{general.validaSesion}" />
			</f:metadata>
				
			<p:growl id="growl" for="growl" showDetail="true" closable="true" />
			
			<p:outputPanel style="background-color: white; padding: 5px;">
				<p:commandLink title="Generar listado de estudiantes" oncomplete="PF('dglEst').show();">
					<i class="fa fa-list-ul" />
					<span>Generar listado</span>					
					<p:spacer width="10px" />																						
				</p:commandLink>		
			
				<p:commandLink title="Procesar matrículas aprobadas">
					<i class="fa fa-check"></i>
					<span>Procesar matrículas</span>											
					<p:spacer width="10px" />																						
				</p:commandLink>
				
				<p:commandLink style="float: right" title="Anular matrícula">
					<i class="fa fa-ban"></i>
					<span>Anular matrícula</span>
					<p:spacer width="10px" />																										
				</p:commandLink>									
			</p:outputPanel>	
			
			<p:dialog header="Generar listado" widgetVar="dglEst" modal="true" closable="true" maximizable="false" resizable="false" width="450px" height="400px">
				
				<p:outputPanel style="text-align: center">		   		
			   		<p:selectOneMenu id="soPeriodoEst" value="#{matricula.soPeriodoEst}">
						<f:selectItem itemLabel="Seleccione Período" itemValue="NA" />
						<f:selectItems value="#{matricula.listPeriodos}" />		
						<p:ajax listener="#{matricula.onChangePeriodoEst()}" update="dtestudiante btnGenerar"/>								
					</p:selectOneMenu>			    			      				      		      			
				</p:outputPanel>
				<br/>				
				<p:dataTable id="dtestudiante" var="dtestudiante" value="#{matricula.estudianteList}" tableStyle="width: auto; min-width: 100%;" 
					paginator="true" rows="10" rowsPerPageTemplate="5,10" paginatorPosition="top" emptyMessage="No existen datos a mostrar" >
				 
				    <p:column headerText="Cédula" style="text-align: center">
				        <h:outputText value="#{dtestudiante.idEstudiante}" />
				    </p:column>
							    
					<p:column headerText="Estudiante">
				        <h:outputText value="#{dtestudiante.apellidos} #{dtestudiante.nombres}" />
				    </p:column>
				    
				    <f:facet name="footer">  
			        	<h:outputText id="footer" value="#{matricula.estudianteList.size()} Registros" />  
			    	</f:facet>  
				</p:dataTable>
				<br/>	
				<h:panelGroup style = "display:block; text-align:center">
					<p:commandButton id="btnGenerar" value="Generar listado" icon="fa fa-list-ul" disabled="#{matricula.estudianteList.size()== 0?true:false}" />	
				</h:panelGroup>
				
			</p:dialog>					
			
			<!-- CONSULTA -->	
			<style>				
				.ui-datatable thead th, .ui-datatable tbody td, .ui-datatable tfoot td, .ui-datatable tfoot th { padding: 2px 10px; }
			</style>
			<br/>		
			<p:outputPanel>		   		
		   		<p:selectOneMenu id="soPeriodo" value="#{matricula.soPeriodo}">
					<f:selectItem itemLabel="Seleccione Período" itemValue="NA" />
					<f:selectItems value="#{matricula.listPeriodos}" />		
					<p:ajax listener="#{matricula.onChangePeriodo()}" update="sheet"/>								
				</p:selectOneMenu>			    			      				      		      			
			</p:outputPanel>
			 				 	
			<p:separator />
			  
			<style>
				.handsontable .htDimmed { color: #2b2b2b; }
				.handsontable.listbox .ht_master table { border: 1px solid #000; border-collapse: separate; }
				.ui-handsontable .ui-datatable-header, .ui-handsontable .ui-datatable-footer { text-align: left; font-weight: 700; font-size: 12px; color: #212121; }
				.handsontable .htAutocompleteArrow { float: right; font-size: 12px; color: #474a4b; cursor: default; width: 16px; text-align: center; }
			</style>
			<pe:sheet id="sheet" widgetVar="sheetWidget" value="#{matricula.matriculaEstList}" var="row"   
			    height="350" rowKey="#{row.codEstudiante}" showRowHeaders="false" resizableCols="true" resizableRows="true" 
			    readOnly="false" emptyMessage="No existen datos a mostrar">  
			  
			    <p:ajax event="change" listener="#{matricula.cellChangeEvent}" />  
			  			   			  
			    <pe:sheetcolumn headerText="Matrícula" readonly="true" value="#{row.codMatricula}" colWidth="60" styleClass="htCenter" />   
			    				
			    <pe:sheetcolumn headerText="Cédula" readonly="true" value="#{row.codEstudiante}" colWidth="60" styleClass="htCenter" />			    
			    				
			   	<pe:sheetcolumn headerText="Estudiante" readonly="true" value="#{row.nomEstudiante}" />
			    
			    <pe:sheetcolumn headerText="Oferta" value="#{row.nomOferta}" colWidth="200" colType="dropdown" selectItems="#{matricula.llenaComboOfertas2()}" />
			       
			    <pe:sheetcolumn headerText="Aprobada" value="#{row.snAprobada}" colWidth="50" colType="checkbox" styleClass="htCenter" />
			    
			    <pe:sheetcolumn headerText="Obsevación" value="#{row.observacion}" colWidth="150"/>  
			    
			    <pe:sheetcolumn headerText="Activo" value="#{row.estado}" colWidth="50" colType="checkbox" styleClass="htCenter" />
			    
			    <f:facet name="footer">  
			        <h:outputText id="footer" value="#{matricula.matriculaEstList.size()} Registros" />  
			    </f:facet>  
			</pe:sheet>  
			
			<br/>
									
	   	</h:form>
	</ui:define>		
	
</ui:composition>

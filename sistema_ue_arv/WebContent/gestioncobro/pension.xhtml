<ui:composition template="/layout/layout.xhtml"
xmlns="http://www.w3.org/1999/xhtml"
xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
xmlns:h="http://xmlns.jcp.org/jsf/html"
xmlns:p="http://primefaces.org/ui"
xmlns:f="http://xmlns.jcp.org/jsf/core">
			
	<ui:define name="titulo"><i class="fa fa-money" /> Gestión de cobros / Pensiones</ui:define>
	
	<ui:define name="content">
		<h:form id="form" style="width: 100%">
			<f:metadata>		    
			    <f:viewAction action="#{general.validaSesion}" />
			</f:metadata>
				
			<p:growl id="growl" for="growl" showDetail="true" closable="true" />
			
			<p:outputPanel style="background-color: white; padding: 5px;">
			
				<p:commandLink title="Cambiar día de vencimiento">
					<i class="fa fa-calendar" />
					<span>Cambiar día de vencimiento</span>					
					<p:spacer width="10px" />							
										
				</p:commandLink>
			
			</p:outputPanel>
			
			<!-- CONSULTA -->	
			<style>				
				.ui-datatable thead th, .ui-datatable tbody td, .ui-datatable tfoot td, .ui-datatable tfoot th { padding: 2px 10px; }
			</style>
			<br/>		
			<p:outputPanel style="display: inline-flex">		   		
		   		<p:selectOneMenu id="soPeriodo" value="#{pension.soPeriodo}">
					<f:selectItem itemLabel="Seleccione Período" itemValue="NA" />
					<f:selectItems value="#{pension.listPeriodos}" />
					<p:ajax listener="#{pension.onChangePeriodo()}" update="soOferta soEstudiante dt"/>						
				</p:selectOneMenu>	
				<p:spacer width="10px" />
				<p:selectOneMenu id="soOferta" value="#{pension.soOferta}">
					<f:selectItem itemLabel="Seleccione Oferta" itemValue="NA" />
					<f:selectItems value="#{pension.listOfertas}" />
					<p:ajax listener="#{pension.onChangeOferta()}" update="soEstudiante dt"/>
				</p:selectOneMenu>	
				<p:spacer width="10px" />				
				<p:selectOneMenu id="soEstudiante" value="#{pension.soEstudiante}" effect="fade" widgetVar="t" filter="true" filterMatchMode="contains">
					<f:selectItem itemLabel="Seleccione Estudiante" itemValue="NA" />
					<f:selectItems value="#{pension.listEstudiantes}" />	
				    <p:column>
		                <h:outputText value="#{t}" />
		            </p:column>			 
		            <p:ajax listener="#{pension.onChangeEstudiante()}" update="dt"/>
		        </p:selectOneMenu>
		        <p:spacer width="10px" />	
				<p:selectOneMenu id="soTipo" value="#{pension.soTipo}">            
		            <f:selectItem itemLabel="Seleccione Pago" itemValue="NA" />
		            <f:selectItem itemLabel="Matrícula" itemValue="M" />
		            <f:selectItem itemLabel="Pensión" itemValue="P" />
		            <p:ajax listener="#{pension.onChangeTipo()}" update="dt soSecuencia"/>
			    </p:selectOneMenu>  
			    <p:spacer width="10px" />
			    <p:selectOneMenu id="soSecuencia" value="#{pension.soSecuencia}" style="display: #{pension.soTipo eq 'P'?'':'none'}">            
		            <f:selectItem itemLabel="No." itemValue="NA" />
		            <f:selectItem itemLabel="01" itemValue="1" />
		            <f:selectItem itemLabel="02" itemValue="2" />
		            <f:selectItem itemLabel="03" itemValue="3" />
		            <f:selectItem itemLabel="04" itemValue="4" />
		            <f:selectItem itemLabel="05" itemValue="5" />
		            <f:selectItem itemLabel="06" itemValue="6" />
		            <f:selectItem itemLabel="07" itemValue="7" />
		            <f:selectItem itemLabel="08" itemValue="8" />
		            <f:selectItem itemLabel="09" itemValue="9" />
		            <f:selectItem itemLabel="10" itemValue="10" />
		            <f:selectItem itemLabel="11" itemValue="11" />
		            <f:selectItem itemLabel="12" itemValue="12" />
		            <p:ajax listener="#{pension.onChangeSec()}" update="dt"/>
			    </p:selectOneMenu>  
			   
			</p:outputPanel>
			 				 	
			<p:separator />
			
			<p:dataTable id="dt" var="dtpension" value="#{pension.pensionList}" tableStyle="width: auto; min-width: 100%;" scrollable="true" scrollHeight="350"
                 emptyMessage="No existen datos a mostrar">
									    
				<p:column headerText="Matrícula" width="50" style="text-align: center">
			        <h:outputText value="#{dtpension.matMatricula.idMatricula}">
			        	<f:convertNumber pattern="00000" />
			        </h:outputText>
			    </p:column>		
			    
			    <p:column headerText="No." width="20" style="text-align: center">
			        <h:outputText value="#{dtpension.secuencia}">
			        	<f:convertNumber pattern="00" />
			        </h:outputText>
			    </p:column>			    
			    
			    <p:column headerText="Estudiante">
			        <h:outputText value="#{dtpension.matMatricula.matEstudiante.apellidos} #{dtpension.matMatricula.matEstudiante.nombres}" />
			    </p:column>	
			    
			    <p:column headerText="Fecha V." width="70" style="text-align: center">
			        <h:outputText value="#{dtpension.fechaVence}">
			        	<f:convertDateTime pattern = "dd/MM/yyyy" />
			        </h:outputText>
			    </p:column>						    			 
			    
			    <p:column headerText="Fecha P." width="70" style="text-align: center">
			        <h:outputText value="#{dtpension.fechaPago}">
			        	<f:convertDateTime pattern = "dd/MM/yyyy" />
			        </h:outputText>
			    </p:column>
			    
			    <p:column headerText="Valor" visible="false">			        
			        <h:outputText value="$ #{dtpension.precio}" /> 
			    </p:column>
			    <p:column headerText="Valor" width="50" exportable="false">			        
			        <div style="text-align: end"><h:outputText value="$ #{dtpension.precio}" /></div> 
			    </p:column>			    
			    
			    <p:column headerText="Desc." width="40" style="text-align: center">			        
		        	<h:outputText value="#{dtpension.gesDescuento.porcentaje}" title="#{dtpension.gesDescuento.descripcion}">
			        	<f:convertNumber pattern="#0" />			        
			        </h:outputText>
			        <h:outputText value="#{dtpension.gesDescuento.porcentaje eq null ? '--':'%'}" title="#{dtpension.gesDescuento.descripcion}" /> 
			    </p:column>
			    
			    <p:column headerText="Total" visible="false">			        
			        <h:outputText value="$ #{dtpension.totalPagar}" /> 
			    </p:column>
			    <p:column headerText="Total" width="50" exportable="false">			        
			        <div style="text-align: end"><h:outputText value="$ #{dtpension.totalPagar}" /></div> 
			    </p:column>
			    
			    <p:column headerText="Abono" visible="false">			        
			        <h:outputText value="$ #{dtpension.abono}" /> 
			    </p:column>
			    <p:column headerText="Abono" width="50" exportable="false">			        
			        <div style="text-align: end"><h:outputText value="$ #{dtpension.abono}" /></div> 
			    </p:column>
			    			    
			    <p:column headerText="Saldo" visible="false">			        
			        <h:outputText value="$ #{dtpension.saldo}" /> 
			    </p:column>
			    <p:column headerText="Saldo" width="50" exportable="false">			        
			        <div style="text-align: end"><h:outputText value="$ #{dtpension.saldo}" /></div> 
			    </p:column>
			    
			    <p:column headerText="Estado" visible="false">
			    	<h:outputText value="#{dtpension.saldo eq '0.00'?'REALIZADO':dtpension.abono eq '0.00'?'PENDIENTE':'PARCIAL'}" />
			    </p:column>			    
			    <p:column headerText="Estado" style="text-align: center" width="80" exportable="false" 
			    	sortBy="#{dtpension.saldo eq '0.00'?'REALIZADO':dtpension.abono eq '0.00'?'PENDIENTE':'PARCIAL'}">
			        <div style="padding: 2px; font-size: 11px; font-weight: bold; background-color: #{dtpension.saldo eq '0.00'?'#aaecaa':dtpension.abono eq '0.00'?'#fff497':'#f3c581'}">
			        	<h:outputText value="#{dtpension.saldo eq '0.00'?'REALIZADO':dtpension.abono eq '0.00'?'PENDIENTE':'PARCIAL'}" />			        	
			        </div>			        			        
			    </p:column>
			    
			    <p:column headerText="Acciones" width="200" style="text-align: center" exportable="false">
			        <p:commandLink title="Pagar" disabled="#{dtpension.saldo eq '0.00'?true:false}">	
							<i class="fa fa-dollar" /> Pagar
					</p:commandLink> | 					
					<p:commandLink title="Enviar notificación de pago" disabled="#{dtpension.saldo eq '0.00'?true:false}">	
							<i class="fa fa-send" /> Notificar
					</p:commandLink> | 
					<p:commandLink title="Imprimir comprobante de pago" disabled="#{dtpension.saldo eq '0.00'?false:true}">	
							<i class="fa fa-file-text-o" /> Imprimir
					</p:commandLink>
			    </p:column>
			    
				 <f:facet name="footer">  
			        <h:outputText id="footer" value="#{pension.pensionList.size()} Registros" />  
			    </f:facet>  	  
			</p:dataTable>
						
			<br/>
			<p:outputPanel style="background-color: white; padding: 5px; text-align: end">
				<h:commandLink value="Exportar a excel" style="color: green">                
	                <p:dataExporter type="xlsx" target="dt" fileName="pensions" />
	            </h:commandLink>		   
            </p:outputPanel>
						
	   	</h:form>
	</ui:define>		
	
</ui:composition>
